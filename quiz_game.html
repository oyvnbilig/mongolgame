<!DOCTYPE html>
<html lang="mn">    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Game</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
</head>
<style>
    /* --- å¸ƒå±€ç³»ç»Ÿ (ä¿æŒä¸å˜) --- */
    .app-shell {
        display: flex; flex-direction: column;
        width: 100vw; height: 100vh;
        background: #f8fafc;
    }

    .game-layout {
        flex: 1; height: 100%;
        display: flex;
        flex-direction: row; 
        padding: 30px; gap: 30px;
        overflow: hidden;
    }

    /* --- ä¾§è¾¹æ  --- */
    .sidebar-nav {
        width: 80px; height: 100%;
        background: white;
        border-right: 1px solid #f1f5f9;
        display: flex; flex-direction: row; 
        justify-content: space-between; align-items: center;
        padding: 30px 0;
        flex-shrink: 0; z-index: 50;
    }

    .nav-top { display: flex; flex-direction: row; align-items: center; gap: 20px; }
    
    /* è¿™é‡Œçš„æ•°å­—ä¿æŒç«–æ’ä»¥ä¾¿äºä¾§è¾¹æ å¸ƒå±€ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ¨ªæ’ï¼Œä½†ä¾§è¾¹æ ç©ºé—´çª„ï¼Œç«–æ’æ•°å­—å…¶å®åœ¨ä¾§è¾¹æ è¿˜å‡‘åˆï¼Œä¸»è¦ä¿®å¼¹çª— */
    /* å¦‚æœä½ æƒ³è®©ä¾§è¾¹æ æ•°å­—ä¹Ÿæ¨ªè¿‡æ¥ï¼Œç»™ .status-badge åŠ ä¸Š writing-mode: horizontal-tb; transform: rotate(90deg); */
    .status-badge {
        writing-mode: vertical-lr;
        padding: 8px 6px; border-radius: 8px;
        font-weight: bold; font-family: monospace;
        font-size: 12px; letter-spacing: 1px;
        text-align: center;
    }
    .timer-style { background: #fff7ed; color: #ea580c; border: 1px solid #ffedd5; }
    .progress-style { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; }

    /* 1. å›¾ç‰‡åŒº */
    .media-strip {
        width: 100%; height: 220px; flex-shrink: 0;
        display: none; flex-direction: column; gap: 15px; overflow-x: auto;
    }
    .media-card {
        background: white; width: 220px; height: 100%;
        border-radius: 16px; padding: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        display: flex; align-items: center; justify-content: center;
        writing-mode: horizontal-tb;
    }
    .media-img { width: 100%; height: 100%; object-fit: contain; border-radius: 8px; }

    /* 2. ç­”é¢˜å¡ç‰‡ */
    .quiz-card {
        flex: 1; width: 100%;
        background: white; border-radius: 24px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.04);
        padding: 40px;
        display: flex; flex-direction: column; gap: 40px;
        overflow-x: auto; position: relative;
    }

    .question-text {
        font-size: 24px; font-weight: 900;
        line-height: 1.8; color: #1e293b;
        text-align: justify; max-height: 85vh; letter-spacing: 1px;
    }

    .options-group { display: flex; flex-direction: column; gap: 20px; }

    /* é€‰é¡¹ */
    .option-btn {
        background: white; border: 1px solid #e2e8f0; border-radius: 16px;
        padding: 20px 15px; cursor: pointer;
        min-height: 140px; width: 70px;
        display: flex; justify-content: flex-start; align-items: center;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative;
    }
    .opt-label {
        font-size: 14px; font-weight: 900; color: #94a3b8;
        margin-bottom: 12px; font-family: sans-serif;
        writing-mode: horizontal-tb; transform: rotate(90deg);
    }
    .opt-content { font-size: 18px; font-weight: 600; color: #334155; line-height: 1.5; text-align: justify; }
    .option-btn:hover { border-color: #cbd5e1; transform: translateY(-2px); }
    .option-btn:active { transform: scale(0.98); }
    .option-btn.selected { border: 2px solid var(--primary-color); background: #eff6ff; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15); }
    .option-btn.selected .opt-label, .option-btn.selected .opt-content { color: var(--primary-color); }
    .option-btn.correct { border: 2px solid #10b981 !important; background: #ecfdf5 !important; }
    .option-btn.correct::after {
        content: '\f00c'; font-family: "Font Awesome 6 Free"; font-weight: 900;
        position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%) rotate(90deg);
        color: #10b981; font-size: 16px;
    }
    .option-btn.wrong { border: 2px solid #ef4444 !important; background: #fef2f2 !important; opacity: 0.7; }
    .option-btn.wrong::after {
        content: '\f00d'; font-family: "Font Awesome 6 Free"; font-weight: 900;
        position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%) rotate(90deg);
        color: #ef4444; font-size: 16px;
    }

    /* æŒ‰é’® */
    .action-bar { padding-left: 20px; display: flex; flex-direction: column; justify-content: flex-end; }
    .action-fab {
        writing-mode: vertical-lr; width: 64px; min-height: 64px; max-height: 140px;
        border-radius: 32px; background: #0f172a; color: white; border: none;
        display: flex; align-items: center; justify-content: center; gap: 10px;
        font-size: 16px; font-weight: bold; letter-spacing: 2px;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.3); transition: all 0.3s; cursor: pointer;
    }
    .action-fab:disabled { background: #e2e8f0; color: #94a3b8; box-shadow: none; cursor: not-allowed; }
    .action-fab:not(:disabled):hover { transform: scale(1.05); box-shadow: 0 15px 30px rgba(15, 23, 42, 0.4); }
    .fab-icon { font-size: 18px; transform: rotate(90deg); }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
        .sidebar-nav { width: 50px; padding: 20px 0; }
        .nav-btn { width: 36px; height: 36px; font-size: 16px; }
        .nav-top { gap: 10px; }
        .status-badge { font-size: 10px; padding: 6px 4px; border-radius: 6px; }
        .game-layout { padding: 15px; gap: 15px; }
        .quiz-card { padding: 20px; gap: 20px; border-radius: 20px; }
        .media-strip { height: 160px; }
        .media-card { width: 160px; }
        .question-text { font-size: 20px; }
        .options-group { gap: 10px; }
        .option-btn { width: 50px; min-height: 90px; padding: 15px 5px; font-size: 14px; }
        .opt-label { font-size: 10px; margin-bottom: 6px; }
        .action-bar { padding-left: 5px; }
        .action-fab { width: 48px; border-radius: 24px; font-size: 14px; }
    }

    /* --- ç»“ç®—å¼¹çª— (å…¨æ–°ä¿®æ­£ç‰ˆ) --- */
    .result-modal-backdrop {
        position: fixed; inset: 0;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(8px);
        display: none; justify-content: center; align-items: center;
        z-index: 100; writing-mode: horizontal-tb; /* é®ç½©å±‚ç”¨æ¨ªæ’ï¼Œæ–¹ä¾¿å±…ä¸­ */
    }

    .result-card {
        background: white;
        padding: 40px;
        border-radius: 30px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        border: 1px solid #f1f5f9;
        
        display: flex; 
        /* ç«–æ’å¸ƒå±€ï¼Œå†…å®¹ä»å·¦å‘å³ */
        writing-mode: vertical-lr; 
        gap: 30px;
        align-items: center; /* å‚ç›´å±…ä¸­ (ç«–æ’çš„äº¤å‰è½´) */
        
        animation: popIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

    /* 1. è¡¨æƒ…åŒ… (å¼ºåˆ¶æ¨ªæ’ï¼Œæ­£å‘æ˜¾ç¤º) */
    .result-emoji {
        font-size: 64px;
        margin-left: 10px;
        /* å…³é”®ï¼šå¼ºåˆ¶æ¨ªæ’ */
        writing-mode: horizontal-tb; 
        text-align: center;
        /* åŠ¨ç”»ï¼šæ— éœ€æ—‹è½¬ï¼Œç›´æ¥è·³åŠ¨ */
        animation: bounce 1s infinite;
    }
    @keyframes bounce { 
        0%, 100% { transform: translateY(0); } 
        50% { transform: translateY(-10px); } 
    }

    /* 2. è¯„ä»·è¯­ (è’™å¤æ–‡ä¿æŒç«–æ’) */
    .result-grade {
        font-size: 28px; font-weight: 900; 
        color: var(--primary-color);
        letter-spacing: 2px;
        /* ç«–æ’é»˜è®¤ */
    }

    /* 3. æ•°æ®ç»Ÿè®¡åŒº */
    .result-stats {
        display: flex; 
        /* ç«–æ’ä¸‹ row = ä»ä¸Šåˆ°ä¸‹ */
        flex-direction: row; 
        gap: 20px;
        border-right: 1px solid #e2e8f0; 
        padding-right: 20px;
        align-items: center; /* å±…ä¸­å¯¹é½ */
    }

    .stat-item {
        display: flex; 
        /* ç«–æ’ä¸‹ column = ä»å·¦å‘å³ */
        flex-direction: column; 
        gap: 8px; 
        align-items: center;
    }

    .stat-label {
        font-size: 12px; color: #94a3b8; font-weight: bold;
        /* æ ‡ç­¾æ˜¯è’™å¤æ–‡ï¼Œä¿æŒç«–æ’ */
    }

    .stat-val {
        font-size: 20px; font-weight: 900; color: #1e293b;
        /* å…³é”®ï¼šæ•°å­—å¼ºåˆ¶æ¨ªæ’ */
        writing-mode: horizontal-tb;
        font-family: 'DIN Alternate', 'Roboto', sans-serif; /* é€‰ç”¨é€‚åˆæ•°å­—çš„å­—ä½“ */
    }

    /* 4. æŒ‰é’®åŒº */
    .result-actions { 
        display: flex; gap: 15px; margin-top: 10px; 
        flex-direction: column; /* ç«–æ’ä¸‹ï¼ŒæŒ‰é’®æ’æˆä¸€åˆ—(å·¦å³) */
    }
    .res-btn {
        width: 50px; height: 50px; /* åœ†å½¢æŒ‰é’®æ›´é«˜ç«¯ */
        border-radius: 50%; border: none; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        font-size: 18px; transition: all 0.2s;
        /* å›¾æ ‡ä¹Ÿéœ€è¦æ¨ªè¿‡æ¥ */
        writing-mode: horizontal-tb;
    }
    .res-btn-primary { background: #1e293b; color: white; box-shadow: 0 4px 10px rgba(30,41,59,0.2); }
    .res-btn-sec { background: #f1f5f9; color: #64748b; }
    .res-btn:hover { transform: scale(1.1); }

    /* --- åˆ†äº«æµ·æŠ¥å¼¹çª— --- */
    /* --- å¼¹çª—å®¹å™¨ï¼ˆä¿æŒæ¨ªæ’ï¼Œä¸ºäº†è®©æŒ‰é’®åœ¨ä¸‹é¢ï¼‰ --- */
    /* --- å¼¹çª—å®¹å™¨ (ä¿æŒæ¨ªæ’ï¼Œç¡®ä¿æŒ‰é’®åœ¨ä¸‹æ–¹) --- */
    .poster-modal {
        position: fixed; inset: 0;
        background: rgba(20, 20, 20, 0.98); /* æ·±è‰²èƒŒæ™¯æ›´æ˜¾é«˜ç«¯ */
        backdrop-filter: blur(8px);
        display: none;
        writing-mode: horizontal-tb !important; /* å¼ºåˆ¶æ¨ªæ’å¸ƒå±€ */
        flex-direction: column;
        justify-content: center; align-items: center;
        z-index: 200;
        overflow: hidden;
    }

    /* --- æµ·æŠ¥æœ¬ä½“ (å›ºå®šå°ºå¯¸æ˜¯ä¿®å¤å¯¼å‡ºé”™ä½çš„å…³é”®ï¼) --- */
    #poster-canvas {
        background: #fdfbf7; /* ææµ…çš„ç±³ç™½è‰²ï¼Œæ¯”çº¯ç™½æ›´æœ‰è´¨æ„Ÿ */
        background-image: 
            radial-gradient(circle at 100% 0%, #eff6ff 0%, transparent 20%),
            radial-gradient(circle at 0% 100%, #fff7ed 0%, transparent 20%);
        
        /* å…³é”®ï¼šä½¿ç”¨å›ºå®šåƒç´ å°ºå¯¸ï¼Œä¸è¦ç”¨ vh/vwï¼Œå¦åˆ™html2canvasè®¡ç®—ä¼šä¹± */
        width: 360px; 
        height: 640px; 
        
        padding: 30px;
        box-sizing: border-box; /* ç¡®ä¿paddingä¸æ’‘å¤§å®¹å™¨ */
        
        /* æ ¸å¿ƒç«–æ’è®¾ç½® */
        writing-mode: vertical-lr; 
        text-orientation: mixed;
        
        display: flex;
        flex-direction: row; /* ç«–æ’ä¸‹ row = å‚ç›´æµ (Top->Bottom) */
        justify-content: space-between; /*ä»¥æ­¤æ‹‰å¼€ å¤´ã€ä¸­ã€åº• çš„è·ç¦» */
        align-items: center; /* å±…ä¸­å¯¹é½ */
        
        position: relative;
        box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        border-radius: 4px; /* è§†è§‰åœ†è§’ */

        /* å…³é”®ï¼šå‘Šè¯‰æ¸²æŸ“å¼•æ“è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å›¾å±‚ */
        transform: translate3d(0, 0, 0); 
        will-change: transform;
    }
    
    /* ç¡®ä¿æ‰€æœ‰æµ·æŠ¥å†…çš„å›¾ç‰‡ä¸ä½¿ç”¨æ‡’åŠ è½½ï¼Œå¹¶ä¸”å¼ºåˆ¶æ˜¾ç¤º */
    #poster-canvas img {
        display: inline-block !important; /* é˜²æ­¢è¢«ä¼˜åŒ–éšè— */
        transform: translateZ(0);
    }
        /* è£…é¥°è¾¹æ¡†ï¼ˆå†…ç¼©è¾¹æ¡†ï¼Œå¢åŠ é«˜çº§æ„Ÿï¼‰ */
    #poster-canvas::before {
        content: ''; position: absolute;
        top: 15px; left: 15px; bottom: 15px; right: 15px; /* ç‰©ç†å››å‘¨ */
        border: 1px solid #e2e8f0;
        pointer-events: none;
        z-index: 0;
    }

    /* --- 1. å¤´éƒ¨ Logo (è§†è§‰å·¦ä¸Š) --- */
    .poster-header {
        z-index: 2; height: 100px;
        display: flex; flex-direction: column; /* Left->Right */
        align-items: center; gap: 15px;
    }
    /* .poster-logo-box {
        writing-mode: horizontal-tb; 
        width: 48px; height: 48px;
        background: var(--primary-color); 
        color: white; border-radius: 12px;
        display: flex; justify-content: center; align-items: center;
        font-size: 24px;
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
    } */
    .poster-logo-box {
        writing-mode: horizontal-tb;
        width: 60px; height: 60px; /* ç¨å¾®åŠ å¤§ä¸€ç‚¹å°ºå¯¸ï¼ŒåŸæ¥çš„48pxå¯èƒ½æ”¾å›¾ç‰‡å¤ªå° */
        
        /* 
        å¦‚æœä½ çš„ Logo æœ¬èº«æ˜¯é€æ˜çš„ï¼Œä¸”æ˜¯æ·±è‰²ï¼Œè¿™é‡Œå¯ä»¥å»æ‰ background å’Œ color 
        å¦‚æœä½ çš„ Logo æ˜¯ç™½è‰²çš„ï¼Œéœ€è¦ä¿ç•™èƒŒæ™¯è‰²ã€‚
        å‡è®¾ä½ çš„ erildu.png æ˜¯æ ‡å‡†çš„å½©è‰² Logoï¼Œå»ºè®®å»æ‰èƒŒæ™¯è‰²ï¼Œæˆ–è€…æ”¹æˆç™½è‰²èƒŒæ™¯ 
        */
        background: transparent; /* å»æ‰è“è‰²èƒŒæ™¯ */
        /* background: white; */ /* æˆ–è€…ç”¨ç™½è‰²èƒŒæ™¯ */
        
        border-radius: 12px;
        display: flex; justify-content: center; align-items: center;
        /* box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); */ /* å¯é€‰ï¼šå»æ‰é˜´å½±çœ‹èµ·æ¥æ›´å¹²å‡€ */
        overflow: hidden; /* é˜²æ­¢å›¾ç‰‡æº¢å‡ºåœ†è§’ */
    }
    /* æ–°å¢ï¼šLogo å›¾ç‰‡ä¸“ç”¨æ ·å¼ */
    .poster-logo-img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* ä¿è¯ Logo å®Œæ•´æ˜¾ç¤ºï¼Œä¸å˜å½¢ */
        display: block; /* æ¶ˆé™¤å›¾ç‰‡åº•éƒ¨çš„é—´éš™ */
    }
    
    .poster-app-title {
        font-size: 14px; font-weight: 900; color: #94a3b8;
        letter-spacing: 3px;
        height: 100%; /* æ’‘æ»¡é«˜åº¦ */
        text-align: center;
    }

    /* --- 2. æ ¸å¿ƒæˆç»©å¡ (è§†è§‰ä¸­é—´) --- */
    /* å°†åˆ†æ•°å’Œç§°å·åŒ…åœ¨ä¸€èµ·ï¼Œè§£å†³â€œ0â€çªå…€çš„é—®é¢˜ */
    .poster-card {
        z-index: 2; flex: 1; /* å æ®ä¸­é—´æ‰€æœ‰ç©ºé—´ */
        display: flex; 
        flex-direction: column; /* Left->Right inside */
        justify-content: center; align-items: center;
        gap: 30px;
        
        /* ç»™ä¸ªèƒŒæ™¯å¡ç‰‡æ„Ÿ */
        /* background: white; */ 
        /* border: 1px solid #f1f5f9; */
        /* border-radius: 20px; */
        /* padding: 20px; */
        /* box-shadow: 0 10px 30px rgba(0,0,0,0.02); */
    }

    /* å°ç« /åœ†å½¢åˆ†æ•°è®¾è®¡ */
    .score-badge {
        writing-mode: horizontal-tb; /* å¿…é¡»æ¨ªæ’ */
        width: 100px; height: 100px;
        border-radius: 50%;
        border: 4px solid var(--primary-light);
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        position: relative;
        background: white;
    }
    .score-val {
        font-family: 'DIN Alternate', sans-serif;
        font-size: 48px; font-weight: 900; color: var(--primary-color);
        line-height: 1;
    }
    .score-label-sub {
        font-size: 10px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px;
        margin-top: 2px;
    }

    /* ç§°å·å±•ç¤º */
    .rank-display {
        display: flex; flex-direction: row; /* å‚ç›´å †å  */
        gap: 15px; align-items: center;
    }
    .rank-deco-line {
        width: 2px; height: 20px; background: var(--primary-color);
        border-radius: 2px; opacity: 0.3;
    }
    .rank-text-group {
        display: flex; flex-direction: row; gap: 10px;align-items: center;
    }
    .rank-label { font-size: 12px; color: #94a3b8; }
    .rank-title { 
        font-size: 42px; font-weight: 900; color: #1e293b;
        text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
    }

    /* å¯„è¯­ */
    .poster-quote {
        font-size: 12px; color: #64748b; font-weight: 500;
        line-height: 1.8;
        /* border-left: 1px dashed #cbd5e1;  */
        /* è§†è§‰ä¸Šæ–¹ */
        padding-left: 15px; margin-left: 10px;
    }

    /* --- 3. åº•éƒ¨äºŒç»´ç  (è§†è§‰å³ä¸‹) --- */
    .poster-footer {
        z-index: 2;
        display: flex; flex-direction: column; /* Left->Right */
        align-items: center; gap: 20px;
        
        /* åˆ†å‰²çº¿ */
        border-top: 1px solid #f1f5f9; /* ç‰©ç†å·¦ä¾§ */
        padding-top: 20px;
    }

    .qr-block {
        display: flex; flex-direction: row; /* Top->Bottom */
        align-items: center; gap: 10px;
    }
    .qr-frame {
        writing-mode: horizontal-tb; /* å¼ºåˆ¶æ¨ªæ’ */
        width: 60px; height: 60px;
        padding: 3px; background: white;
        border: 1px solid #e2e8f0; border-radius: 8px;
    }
    /* .qr-frame img { width: 100%; height: 100%; object-fit: contain; opacity: 0.9; } */
    .qr-frame img { 
        width: 100%; 
        height: 100%; 
        object-fit: cover; /* æ”¹æˆ cover ä¼šå¡«æ»¡æ ¼å­ï¼Œçœ‹èµ·æ¥æ›´æ•´é½ */
        opacity: 1; /* ç¡®ä¿ä¸é€æ˜ */
        display: block;
    }
    .qr-caption { font-size: 10px; color: #94a3b8; font-weight: bold; height: 60px; }


    /* --- æŒ‰é’®åŒº (æµ·æŠ¥ä¸‹æ–¹) --- */
    .poster-actions {
        margin-top: 30px;
        display: flex; gap: 40px;
        writing-mode: horizontal-tb;
    }
    .action-item {
        display: flex; flex-direction: column; align-items: center; gap: 10px;
        cursor: pointer;
    }
    .action-btn {
        width: 56px; height: 56px; border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        font-size: 20px; border: none; transition: transform 0.2s;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .action-item:hover .action-btn { transform: translateY(-3px); }
    .action-item:active .action-btn { transform: scale(0.95); }

    .btn-dl { background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; }
    .btn-x { background: rgba(255,255,255,0.1); color: #cbd5e1; border: 1px solid rgba(255,255,255,0.2); }

    .action-text {
        font-size: 12px; color: #94a3b8; writing-mode: vertical-lr; height: 30px;
    }


</style>
<body>
    <div class="app-shell">
         <!-- ä¾§è¾¹æ  -->
         <nav class="sidebar-nav">
             <div class="nav-top">
                <div class="nav-btn" onclick="history.back()"><i class="fa-solid fa-arrow-left"></i></div>
                <div class="status-badge progress-style" id="progress">1 / 10</div>
                <div class="status-badge timer-style" id="timer">00:00</div>
             </div>
             <div style="font-size:18px; color:#cbd5e1; writing-mode:vertical-lr; font-weight:900; margin-bottom:20px;">
                <i class="fa-solid fa-graduation-cap"></i>
             </div>
         </nav>

         <!-- æ¸¸æˆä¸»å¸ƒå±€ -->
         <main class="game-layout scroll-hide">
            <div class="media-strip scroll-hide" id="media-area"></div>
            <div class="quiz-card scroll-hide">
                <div class="question-text" id="q-text">Loading...</div>
                <div class="options-group" id="opt-area"></div>
                <div class="action-bar">
                    <button id="action-btn" class="action-fab" disabled>
                        <i class="fa-solid fa-check fab-icon"></i> 
                        <span>á ªá  á ²á ¤á ¯á  á ¬á ¤</span>
                    </button>
                </div>
            </div>
         </main>
    </div> 

    <!-- ç»“ç®—å¼¹çª— -->
    <div id="result-modal" class="result-modal-backdrop">
        <div class="result-card">
            <!-- 1. è¡¨æƒ… (æ¨ªæ’) -->
            <div class="result-emoji" id="res-emoji">ğŸ¤©</div>

            <!-- 2. è¯„ä»· (ç«–æ’) -->
            <div class="result-grade" id="res-grade">á ­á  á ¶á ¢á ¬á  á ®á °á ¢á ­</div>

            <!-- 3. æ•°æ® (æ··åˆ) -->
            <div class="result-stats">
                <div class="stat-item">
                    <span class="stat-label">á ¬á ¤á ­á ¤á ´á  á ­á á  </span> <!-- Time -->
                    <span class="stat-val" id="res-time">00:00</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">á £á ¨á £á ­á £</span> <!-- Score -->
                    <span class="stat-val" id="res-score">100%</span>
                </div>
            </div>

            <!-- 4. æŒ‰é’® (æ¨ªæ’å›¾æ ‡) -->
            <div class="result-actions">
                <button class="res-btn res-btn-primary" onclick="location.reload()">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
                <button class="res-btn res-btn-sec" onclick="history.back()">
                    <i class="fa-solid fa-list"></i>
                </button>
                <button class="res-btn res-btn-primary" onclick="showPoster()">
                    <i class="fa-solid fa-share-nodes"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- æµ·æŠ¥ç”Ÿæˆå¼¹çª— -->
    <div id="poster-modal" class="poster-modal">
    
        <!-- 1. æµ·æŠ¥ç»˜åˆ¶åŒº -->
        <div id="poster-canvas">
            
            <!-- Header: Logo -->
            <div class="poster-header">
                <div class="poster-logo-box">
                    <!-- <i class="fa-solid fa-graduation-cap"></i> -->
                    <img src="assets/images/erildu.png" class="poster-logo-img" alt="Logo">
                </div>
                <div class="poster-app-title">á ®á £á ©á ­á £á ¯ á °á £á ·á ¢á ¯á ²á  </div>
            </div>

            <!-- Body: Card -->
            <div class="poster-card">
                
                <!-- åˆ†æ•°å°ç«  (Badge) -->
                <div class="score-badge">
                    <span class="score-val" id="poster-score-val">100</span>
                    <span class="score-label-sub">POINT</span>
                </div>

                <!-- ç§°å·ç»„ -->
                <div class="rank-display">
                    <div class="rank-deco-line"></div>
                    <div class="rank-text-group">
                        <div class="rank-label">á ®á ¢á ¨á ¦<br>á ´á £á ¯á  </div> <!-- æˆ‘çš„ç§°å· -->
                        <div class="rank-title" id="poster-rank-title">á ®á ¡á ·á ­á ¡á ¨</div>
                    </div>
                    <div class="rank-deco-line"></div>
                </div>

                <!-- å¯„è¯­ -->
                <div class="poster-quote">
                    á ¡á ¬á ¡ á ¬á ¡á ¯á ¡ á ªá ¡á ¨ á ¬á  á ¶á ¢á ·á  á ¯á  á ¶á á   á ‚ <br>
                    á °á £á ·á ¢á ¯á ²á   á á  á ´á   á ¡á ¬á ¢á ¯á ¡á ¶á á ¡ á ƒ
                </div>
            </div>

            <!-- Footer: QR Codes -->
            <div class="poster-footer">
                <div class="qr-block">
                    <div class="qr-frame">
                        <!-- <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=MiniApp" alt="QR"> -->
                        <img src="assets/images/erildu_xcx.jpg" alt="MiniApp">
                    </div>
                    <div class="qr-caption">á ªá ¢á ´á ¢á ¬á  á ¨<br>á «á ·á £á ­á ·á  á ®</div>
                </div>
                <div class="qr-block">
                    <div class="qr-frame">
                        <!-- <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Official" alt="QR"> -->
                        <img src="assets/images/erildu_gzh.jpg" alt="Official">
                    </div>
                    <div class="qr-caption">á ªá ¢á ³á ¡á ¨â€¯á ¢<br>á ³á  á ­á  á ­á  á ·á  á ¢</div>
                </div>
            </div>

        </div>

        <!-- 2. æ“ä½œæŒ‰é’® -->
        <div class="poster-actions">
            <div class="action-item" onclick="closePoster()">
                <button class="action-btn btn-x"><i class="fa-solid fa-xmark"></i></button>
                <span class="action-text">á ¬á  á ­á  á ¬á ¤</span>
            </div>
            <div class="action-item" onclick="savePoster()" id="save-btn-container">
                <button class="action-btn btn-dl"><i class="fa-solid fa-download"></i></button>
                <span class="action-text">á ¬á  á ³á  á ­á  á ¯á  á ¬á ¤</span>
            </div>
        </div>
    </div>
    <script type="module">
        import { questions } from './js/data.js';

        const params = new URLSearchParams(window.location.search);
        const category = params.get('category');
        
        let list = [];
        let currIdx = 0;
        let score = 0;
        let selectedIdx = null;
        let isGraded = false;
        
        let timerSec = 0;
        let timerId = null;

        const els = {
            mediaArea: document.getElementById('media-area'),
            qText: document.getElementById('q-text'),
            optArea: document.getElementById('opt-area'),
            actionBtn: document.getElementById('action-btn'),
            modal: document.getElementById('result-modal'),
            
            timer: document.getElementById('timer'),
            progress: document.getElementById('progress'),

            resEmoji: document.getElementById('res-emoji'),
            resGrade: document.getElementById('res-grade'),
            resTime: document.getElementById('res-time'),
            resScore: document.getElementById('res-score')
        };

        function init() {
            if (!category) { alert('Error'); return; }
            list = questions.filter(q => q.category === category).sort(() => Math.random() - 0.5);
            if (!list.length) { els.qText.innerText = "No questions."; return; }

            startTimer();
            loadQuestion();
        }

        function loadQuestion() {
            if (currIdx >= list.length) { finish(); return; }
            const data = list[currIdx];
            
            selectedIdx = null;
            isGraded = false;
            
            els.progress.innerText = `${currIdx + 1} / ${list.length}`;

            const btnSpan = els.actionBtn.querySelector('span');
            const btnIcon = els.actionBtn.querySelector('i');
            els.actionBtn.disabled = true;
            els.actionBtn.style.background = "#0f172a"; 
            btnSpan.innerText = "á ªá  á ²á ¤á ¯á  á ¬á ¤"; 
            btnIcon.className = "fa-solid fa-check fab-icon";

            els.qText.innerText = data.question;
            els.mediaArea.innerHTML = '';
            const imgs = Array.isArray(data.image) ? data.image : (data.image ? [data.image] : []);
            if (imgs.length) {
                els.mediaArea.style.display = 'flex';
                imgs.forEach(src => els.mediaArea.innerHTML += `<div class="media-card"><img src="${src}" class="media-img"></div>`);
            } else {
                els.mediaArea.style.display = 'none';
            }

            els.optArea.innerHTML = '';
            const opts = data.options.map((txt, idx) => ({ txt, idx })).sort(() => Math.random() - 0.5);
            const labels = ['A', 'B', 'C', 'D', 'E'];

            opts.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.dataset.originalIdx = opt.idx;
                btn.innerHTML = `<span class="opt-label">${labels[i]}</span><span class="opt-content">${opt.txt}</span>`;
                btn.onclick = () => handleSelect(btn);
                els.optArea.appendChild(btn);
            });

            document.querySelector('.game-layout').scrollLeft = 0;
            els.optArea.scrollLeft = 0; 
        }

        function handleSelect(btn) {
            if (isGraded) return; 
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedIdx = parseInt(btn.dataset.originalIdx);
            els.actionBtn.disabled = false;
        }

        els.actionBtn.onclick = () => {
            const btnSpan = els.actionBtn.querySelector('span');
            const btnIcon = els.actionBtn.querySelector('i');

            if (!isGraded) {
                const data = list[currIdx];
                const isCorrect = (selectedIdx === data.correct);
                if (isCorrect) score++;

                document.querySelectorAll('.option-btn').forEach(btn => {
                    const oIdx = parseInt(btn.dataset.originalIdx);
                    if (oIdx === data.correct) {
                        btn.classList.add('correct');
                        btn.classList.remove('selected');
                    } else if (oIdx === selectedIdx && !isCorrect) {
                        btn.classList.add('wrong');
                        btn.classList.remove('selected');
                    }
                });

                isGraded = true;
                els.actionBtn.style.background = "var(--primary-color)";
                if (currIdx === list.length - 1) {
                    btnSpan.innerText = "á ³á  á ­á ¤á °á ¬á  á ¬á ¤"; 
                    btnIcon.className = "fa-solid fa-flag-checkered fab-icon";
                } else {
                    btnSpan.innerText = "á ³á  á ·á  á ­á  á ¬á ¢"; 
                    btnIcon.className = "fa-solid fa-arrow-right fab-icon";
                }
            } else {
                currIdx++;
                loadQuestion();
            }
        };

        function startTimer() {
            timerId = setInterval(() => {
                timerSec++;
                const m = Math.floor(timerSec / 60).toString().padStart(2, '0');
                const s = (timerSec % 60).toString().padStart(2, '0');
                els.timer.innerText = `${m}:${s}`;
            }, 1000);
        }

        // æ–°å¢å…ƒç´ å¼•ç”¨
        const posterEls = {
            modal: document.getElementById('poster-modal'),
            score: document.getElementById('poster-score-val'),
            rank: document.getElementById('poster-rank-title'),
            saveBtn: document.getElementById('save-btn')
        };

        function finish() {
            clearInterval(timerId);
            const percentage = Math.round((score / list.length) * 100);
            
            let gradeText = "";
            let emoji = "";
            let gradeColor = "";

            if (percentage === 100) {
                gradeText = "á ­á  á ¶á ¢á ¬á  á ®á °á ¢á ­"; 
                emoji = "ğŸ¤©";
                gradeColor = "#10b981"; 
            } else if (percentage >= 90) {
                gradeText = "á ®á  á °á ¢ á °á  á ¶á ¢á ¨"; 
                emoji = "ğŸ˜";
                gradeColor = "#3b82f6"; 
            } else if (percentage >= 60) {
                gradeText = "á ªá £á ¯á ¤á ®á µá ¢â€¯á ²á  á ¢"; 
                emoji = "ğŸ¤”";
                gradeColor = "#f59e0b"; 
            } else if (percentage >= 25) {
                gradeText = "á ¬á ¢á ´á ¢á ¶á ¡á ¬á ¦ á ¬á ¡á ·á ¡á ­á ²á ¡á ¢"; 
                emoji = "ğŸ˜®â€ğŸ’¨";
                gradeColor = "#f97316"; 
            } else {
                gradeText = "á ®á  á ­á ¤"; 
                emoji = "ğŸ˜­";
                gradeColor = "#ef4444"; 
            }

            let rankTitle = "";
            if (percentage === 100) {
                rankTitle = "á ®á ¡á ·á ­á ¡á ¨"; // å¤§å¸ˆ/æ™ºè€… (Mergen)
            } else if (percentage >= 85) {
                rankTitle = "á ¡á ·á ³á ¡á ®á ²á ¡á ¨"; // å­¦è€… (Erdemten)
            } else if (percentage >= 60) {
                rankTitle = "á °á ¤á ·á ¤á ¯á ´á  á ­á ´á ¢"; // å­¦ä¹ è€… (Surulcagci)
            } else {
                rankTitle = "á ¡á ¬á ¢á ¯á  á ¨ á °á ¤á ·á ¤á ­á ´á ¢"; // åˆå­¦è€… (Ehilan surugci)
            }

            posterEls.score.innerText = percentage;
            posterEls.rank.innerText = rankTitle;

            els.resTime.innerText = els.timer.innerText;
            els.resScore.innerText = percentage + "%";
            els.resGrade.innerText = gradeText;
            els.resGrade.style.color = gradeColor;
            els.resEmoji.innerText = emoji;

            els.modal.style.display = 'flex';
        }

        init();
        // --- æ–°å¢æµ·æŠ¥ç›¸å…³å‡½æ•° ---

        window.showPoster = function() {
            // éšè—æ™®é€šç»“ç®—å¼¹çª—
            document.getElementById('result-modal').style.display = 'none';
            // æ˜¾ç¤ºæµ·æŠ¥å¼¹çª—
            posterEls.modal.style.display = 'flex';
        }

        window.closePoster = function() {
            posterEls.modal.style.display = 'none';
            // æ¢å¤æ˜¾ç¤ºæ™®é€šç»“æœ
            document.getElementById('result-modal').style.display = 'flex';
        }

        window.savePoster = function() {
            const node = document.getElementById('poster-canvas');
            const btnContainer = document.getElementById('save-btn-container');

            // 1. è®¾ç½®åŠ è½½çŠ¶æ€
            const oldHtml = btnContainer.innerHTML;
            btnContainer.innerHTML = '<button class="action-btn btn-dl"><i class="fa-solid fa-spinner fa-spin"></i></button><span class="action-text">Wait...</span>';
            btnContainer.style.pointerEvents = 'none';

            // 2. é¢„å¤„ç†ï¼šç¡®ä¿äºŒç»´ç ç­‰å›¾ç‰‡å·²åŠ è½½ä¸”ä¸è·¨åŸŸ
            // html-to-image ä¼šè‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿èƒŒæ™¯è‰²
            const options = {
                backgroundColor: '#fdfbf7', // å¼ºåˆ¶èƒŒæ™¯è‰²ï¼Œé˜²æ­¢é€æ˜
                style: {
                    // å¼ºåˆ¶é‡ç½®å¯èƒ½å¹²æ‰°çš„å±æ€§
                    margin: '0',
                },
                // å…³é”®ï¼šé’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼Œæé«˜åƒç´ å¯†åº¦
                pixelRatio: 2, 
            };

            // 3. ç”Ÿæˆå›¾ç‰‡
            htmlToImage.toPng(node, options)
                .then(function (dataUrl) {
                    // 4. ä¸‹è½½é€»è¾‘
                    const link = document.createElement('a');
                    link.download = 'MongolQuiz_Card.png';
                    link.href = dataUrl;
                    link.click();

                    // æ¢å¤æŒ‰é’®
                    btnContainer.innerHTML = oldHtml;
                    btnContainer.style.pointerEvents = 'auto';
                })
                .catch(function (error) {
                    console.error('oops, something went wrong!', error);
                    alert("Image generation failed: " + error.message);
                    btnContainer.innerHTML = oldHtml;
                    btnContainer.style.pointerEvents = 'auto';
                });
        }
    </script>
</body>
</html>